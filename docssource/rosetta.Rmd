---
title: "Rosetta store: contrasts"
output: 
  html_document:
    includes:
         in_header: ganalytics.txt
    toc: true
    toc_float:
         collapsed: false
editor_options: 
  chunk_output_type: console
---


```{r echo=FALSE,results='hide'}
source("../R/functions.R")
```

`r keywords("jamovi, SPSS, R, contrasts, comparisons, planned comparisons")`

  
# Introduction

Here you can find comparisons of  results obtained in jamovi GAMLj, jamovi (jmv), pure R, and SPSS. When not explicitely discussed, the code of different software is written with the aim of obtaing the identical results across programs.

Example data are [here]((https://github.com/mcfanda/gamlj_docs/blob/master/data/rosetta.contrasts.csv). One continuous dependent variable, one factor with 4 groups.


Unfortunately, contrasts coding scheme get different names in different publications and are implemented in different ways across software. Things can get a bit confusing because of this.  For partially overlapping coding scheme definitions see [UCLA idre web site](https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/), [SPSS manual](https://www.ibm.com/support/knowledgecenter/en/SSLVMB_20.0.0/com.ibm.spss.statistics.help/contrasts.htm) and _Cohen, J., Cohen, P., West, S. G., & Aiken, L. S. (2013). Applied multiple regression/correlation analysis for the behavioral sciences. Routledge._

To clarify things we should recall that a contrast is a way to code the dummy variables representing the K-1  comparisons necessary to estimate the categorical variable effect (K= number of groups).

The contrast values and associated t-tests one obtains from any software are the regression coefficients estimated in a model with the dummies coded accordingly to the contrasts coding scheme. Thus, coefficients that are comparing the same groups but have different scales will be different in the value but will have the same t-test and p-value. For example, a contrast on a dichotomous variable code `1 vs -1` will have the same p-value of a contrast coded `100 vs -100` or  `.5 vs -.5`, but the coefficient value will be different. They will be, howerver, proportional to each other. 

To interpret a contrast, it is often necessary to refer to "the first group" or "subsequent groups". The order is always defined as the alphanumeric order.

A coding scheme influences also the intercepts of the estimated model. When contrasts are estimated in a model without interaction, the intercept is immaterial. However, when interactions are in the model, the intercept determines for which level of the categorical variable the effects of other independent variables in the model are estimated. In all the contrasts we examine here, the intercept is always the grand mean.

# Contrasts: deviation

## Meaning

<b>Definition:</b><i> Compares each group mean to the grand mean. The grand mean is the mean of the groups means. The last group is omitted</i>



## Jamovi ANOVA

<img src="rosetta/contrasts/c1.anova1.png" class="img-responsive" alt="">

Setting the contrasts to `deviation`

<img src="rosetta/contrasts/c1.anova2.png" class="img-responsive" alt="">

Results:

<img src="rosetta/contrasts/r.c1.anova1.png" class="img-responsive" alt="">


## Jamovi GAMLj GLM

<img src="rosetta/contrasts/c1.gamlj1.png" class="img-responsive" alt="">

By default, GAMLj sets contrasts to `deviation`, so `default` and `deviation` is equivalent (this may change in future releases)

<img src="rosetta/contrasts/c1.gamlj2.png" class="img-responsive" alt="">

Results:

<img src="rosetta/contrasts/r.c1.gamlj1.png" class="img-responsive" alt="">

The expected means of the four groups are:

<img src="rosetta/contrasts/r.c1.gamlj2.png" class="img-responsive" alt="">

## SPSS

Please note that SPSS default sets the last group as reference group (the omitted group), thus to obtain the same results as before, we should set  `/CONTRAST(Group)=Simple(1)`, mind the "1"", which corresponds to "first" in the GUI options.


```
UNIANOVA Score BY Group
  /CONTRAST(Group)=Deviation(1)
  /METHOD=SSTYPE(3)
  /INTERCEPT=INCLUDE
  /PRINT=TEST(LMATRIX)
  /CRITERIA=ALPHA(.05)
  /DESIGN=Group.

```

<img src="rosetta/contrasts/r.c1.spss1.png" class="img-responsive" alt="">


## R

In R, deviation contrast is called `contr.sum`.


```{r}
dat<-read.csv2("../data/rosetta.contrasts.csv")
### means
(mm<-tapply(dat$Score, dat$Group, mean))

mm[2]-mean(mm)
#### contrast=deviation or effect coding #######
dat$Group<-factor(dat$Group)
contrasts(dat$Group)<-contr.sum(4)
contrasts(dat$Group)
model<-lm(Score~Group,data=dat)
summary(model)

```


# Contrasts: simple

## Meaning

<b>Definition:</b><i> Compares each group with the first group.</i>

## Jamovi ANOVA

<img src="rosetta/contrasts/c2.anova1.png" class="img-responsive" alt="">

Setting the contrasts to `simple`

<img src="rosetta/contrasts/c2.anova2.png" class="img-responsive" alt="">

Results:

<img src="rosetta/contrasts/r.c2.anova1.png" class="img-responsive" alt="">


## Jamovi GAMLj GLM

Setting the contrasts in GAMLj is identical to the ANOVA module, so I omitted the screenshot from now on. Results are:

<img src="rosetta/contrasts/r.c2.gamlj1.png" class="img-responsive" alt="">


## SPSS

Please note that SPSS default sets the last group as reference group, thus to obtain the same results as before, we should set  `/CONTRAST(Group)=Simple(1)`, mind the "1"", which corresponds to "first" in the GUI options.

<img src="rosetta/contrasts/c2.spss1.png" class="img-responsive" alt="">


```
UNIANOVA Score BY Group
  /CONTRAST(Group)=Simple(1)
  /METHOD=SSTYPE(3)
  /INTERCEPT=INCLUDE
  /PRINT=TEST(LMATRIX)
  /CRITERIA=ALPHA(.05)
  /DESIGN=Group.


```

<img src="rosetta/contrasts/r.c2.spss1.png" class="img-responsive" alt="">

  





## R

In R, simple contrast is called `contr.treatment`.

```{r}

#### contrast=treatment or effect dummy #######
dat$Group<-factor(dat$Group)
contrasts(dat$Group)<-contr.treatment(4)
contrasts(dat$Group)
model<-lm(Score~Group,data=dat)
summary(model)

```



# Contrast: difference 

Difference and helmert contrasts are great source of confusion when one is comparing different software results. SPSS and jamovi uses the same definition of them, but R has a different implementation. Different authors uses different definitions, so be aware of which comparisons are implemented.


<i>Compares group each group with the average of previous groups. First group omitted.</i> 

This is sometimes named _Reverse Helmert Coding_ , cf. [UCLA idre web site](https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/). 

## Jamovi ANOVA

<img src="rosetta/contrasts/c3.anova1.png" class="img-responsive" alt="">

Results:

<img src="rosetta/contrasts/r.c3.anova1.png" class="img-responsive" alt="">


## Jamovi GAMLj GLM

<img src="rosetta/contrasts/r.c3.gamlj1.png" class="img-responsive" alt="">

## SPSS

```
UNIANOVA Score BY Group
  /CONTRAST(Group)=DIFFERENCE
  /METHOD=SSTYPE(3)
  /INTERCEPT=INCLUDE
  /PRINT=TEST(LMATRIX)
  /CRITERIA=ALPHA(.05)
  /DESIGN=Group.


```

<img src="rosetta/contrasts/r.c3.spss1.png" class="img-responsive" alt="">



## R

The difference contrast t-test and p-value can be obtained in R using the `contr.helmert()` function. Despite the name, `contr.helmert()` implements what is usually named "Reversed Helmert contrast". Furthermore, the contrast weights in R are scaled differently than in SPSS or jamovi, thus the contrast values (coefficients) are not identical to the ones obtained in jamovi, but they are proportional to them (that is why the t-tests are the same).

```{r}

dat$Group<-factor(dat$Group)
contrasts(dat$Group)<-contr.helmert(4)
contrasts(dat$Group)
model<-lm(Score~Group,data=dat)
summary(model)

```

To obtain the jamovi/SPSS values in R, we should multiply the coefficients obtained in R by the index of the column of the contrasts.

```{r}

coef(model)*c(1,2,3,4)

```

Or divide the contrast weights by the index of the columns (starting from 2 because 1 is implicitily assigned to the intercept)

```{r}
contrasts(dat$Group)<-contr.helmert(4)/matrix(rep(2:4,each=4),ncol=3)
contrasts(dat$Group)
model<-lm(Score~Group,data=dat)
summary(model)
```




